-- Optional dev seed data (NOT executed by `pnpm migrate`)
-- Run via:
--   pnpm seed:dev
-- or:
--   psql "$DATABASE_URL" -f migrations/_seed_dev.sql
--
-- Notes:
-- - Intended for local development only.
-- - Assumes all schema migrations have been applied.
-- - Password for all seeded accounts: "Test123!"
-- - Password hash is bcrypt (rounds=12) for "Test123!".

-- ---------------------------------------------------------------------
-- Tenants
-- ---------------------------------------------------------------------
INSERT INTO tenants (id, name, business_type, status) VALUES
  ('11111111-1111-4111-8111-111111111111', 'X Cafe', 'CAFE', 'ACTIVE'),
  ('22222222-2222-4222-8222-222222222222', 'Nodepresso', 'CAFE', 'ACTIVE'),
  ('33333333-3333-4333-8333-333333333333', 'Posgres Cafe', 'CAFE', 'ACTIVE')
ON CONFLICT (id) DO NOTHING;

-- ---------------------------------------------------------------------
-- Branches
-- ---------------------------------------------------------------------
INSERT INTO branches (id, tenant_id, name, address, status) VALUES
  ('10000000-0000-4000-8000-000000000001', '11111111-1111-4111-8111-111111111111', 'Sen Sok', 'Sen Sok, Phnom Penh', 'ACTIVE'),
  ('10000000-0000-4000-8000-000000000002', '11111111-1111-4111-8111-111111111111', 'Olympic', 'Olympic, Phnom Penh', 'ACTIVE'),
  ('20000000-0000-4000-8000-000000000001', '22222222-2222-4222-8222-222222222222', 'Nodepresso Main', 'BKK, Phnom Penh', 'ACTIVE'),
  ('30000000-0000-4000-8000-000000000001', '33333333-3333-4333-8333-333333333333', 'Posgres Main', 'Toul Tom Pong, Phnom Penh', 'ACTIVE')
ON CONFLICT (id) DO NOTHING;

-- ---------------------------------------------------------------------
-- Accounts (login identities)
-- ---------------------------------------------------------------------
INSERT INTO accounts (id, phone, password_hash, status, created_at, updated_at) VALUES
  ('50000000-0000-4000-8000-000000000001', '+1234567890', '$2b$12$2tEqR2fsxAOgcXCjDqbsA.0qZhePT6ea.epSVTuJcaF2tZIowBauu', 'ACTIVE', NOW(), NOW()),
  ('50000000-0000-4000-8000-000000000002', '+1234567891', '$2b$12$2tEqR2fsxAOgcXCjDqbsA.0qZhePT6ea.epSVTuJcaF2tZIowBauu', 'ACTIVE', NOW(), NOW()),
  ('50000000-0000-4000-8000-000000000003', '+1234567892', '$2b$12$2tEqR2fsxAOgcXCjDqbsA.0qZhePT6ea.epSVTuJcaF2tZIowBauu', 'ACTIVE', NOW(), NOW()),
  ('50000000-0000-4000-8000-000000000004', '+1234567893', '$2b$12$2tEqR2fsxAOgcXCjDqbsA.0qZhePT6ea.epSVTuJcaF2tZIowBauu', 'ACTIVE', NOW(), NOW()),
  ('50000000-0000-4000-8000-000000000005', '+1123456789', '$2b$12$2tEqR2fsxAOgcXCjDqbsA.0qZhePT6ea.epSVTuJcaF2tZIowBauu', 'ACTIVE', NOW(), NOW()),
  ('50000000-0000-4000-8000-000000000006', '+2123456789', '$2b$12$2tEqR2fsxAOgcXCjDqbsA.0qZhePT6ea.epSVTuJcaF2tZIowBauu', 'ACTIVE', NOW(), NOW()),
  ('50000000-0000-4000-8000-000000000007', '+3123456789', '$2b$12$2tEqR2fsxAOgcXCjDqbsA.0qZhePT6ea.epSVTuJcaF2tZIowBauu', 'ACTIVE', NOW(), NOW()),
  ('50000000-0000-4000-8000-000000000008', '+4123456789', '$2b$12$2tEqR2fsxAOgcXCjDqbsA.0qZhePT6ea.epSVTuJcaF2tZIowBauu', 'ACTIVE', NOW(), NOW())
ON CONFLICT (phone) DO NOTHING;

-- ---------------------------------------------------------------------
-- Employees (tenant memberships)
-- ---------------------------------------------------------------------
INSERT INTO employees (
  id,
  tenant_id,
  account_id,
  phone,
  email,
  password_hash,
  first_name,
  last_name,
  display_name,
  default_branch_id,
  last_branch_id,
  status,
  created_at,
  updated_at
) VALUES
  -- X Cafe memberships
  ('60000000-0000-4000-8000-000000000001', '11111111-1111-4111-8111-111111111111', '50000000-0000-4000-8000-000000000001', '+1234567890', 'zorng.lim@xcafe.demo', '$2b$12$2tEqR2fsxAOgcXCjDqbsA.0qZhePT6ea.epSVTuJcaF2tZIowBauu', 'Zorng', 'Lim', 'Zorng Lim', '10000000-0000-4000-8000-000000000001', '10000000-0000-4000-8000-000000000001', 'ACTIVE', NOW(), NOW()),
  ('60000000-0000-4000-8000-000000000002', '11111111-1111-4111-8111-111111111111', '50000000-0000-4000-8000-000000000002', '+1234567891', 'john.smith@xcafe.demo', '$2b$12$2tEqR2fsxAOgcXCjDqbsA.0qZhePT6ea.epSVTuJcaF2tZIowBauu', 'John', 'Smith', 'John Smith', '10000000-0000-4000-8000-000000000001', '10000000-0000-4000-8000-000000000001', 'ACTIVE', NOW(), NOW()),
  ('60000000-0000-4000-8000-000000000003', '11111111-1111-4111-8111-111111111111', '50000000-0000-4000-8000-000000000003', '+1234567892', 'adam.love@xcafe.demo', '$2b$12$2tEqR2fsxAOgcXCjDqbsA.0qZhePT6ea.epSVTuJcaF2tZIowBauu', 'Adam', 'Love', 'Adam Love', '10000000-0000-4000-8000-000000000002', '10000000-0000-4000-8000-000000000002', 'ACTIVE', NOW(), NOW()),
  ('60000000-0000-4000-8000-000000000004', '11111111-1111-4111-8111-111111111111', '50000000-0000-4000-8000-000000000004', '+1234567893', 'joan.dune@xcafe.demo', '$2b$12$2tEqR2fsxAOgcXCjDqbsA.0qZhePT6ea.epSVTuJcaF2tZIowBauu', 'Joan', 'Dune', 'Joan Dune', '10000000-0000-4000-8000-000000000002', '10000000-0000-4000-8000-000000000002', 'ACTIVE', NOW(), NOW()),

  -- Nodepresso memberships
  ('60000000-0000-4000-8000-000000000005', '22222222-2222-4222-8222-222222222222', '50000000-0000-4000-8000-000000000005', '+0123456789', 'nika.chhun@demo.local', '$2b$12$2tEqR2fsxAOgcXCjDqbsA.0qZhePT6ea.epSVTuJcaF2tZIowBauu', 'Nika', 'Chhun', 'Nika Chhun', '20000000-0000-4000-8000-000000000001', '20000000-0000-4000-8000-000000000001', 'ACTIVE', NOW(), NOW()),
  ('60000000-0000-4000-8000-000000000006', '22222222-2222-4222-8222-222222222222', '50000000-0000-4000-8000-000000000006', '+1123456789', 'justin.bieber@nodepresso.demo', '$2b$12$2tEqR2fsxAOgcXCjDqbsA.0qZhePT6ea.epSVTuJcaF2tZIowBauu', 'Justin', 'Bieber', 'Justin Bieber', '20000000-0000-4000-8000-000000000001', '20000000-0000-4000-8000-000000000001', 'ACTIVE', NOW(), NOW()),
  ('60000000-0000-4000-8000-000000000007', '22222222-2222-4222-8222-222222222222', '50000000-0000-4000-8000-000000000007', '+2123456789', 'justin.cook@nodepresso.demo', '$2b$12$2tEqR2fsxAOgcXCjDqbsA.0qZhePT6ea.epSVTuJcaF2tZIowBauu', 'Justin', 'Cook', 'Justin Cook', '20000000-0000-4000-8000-000000000001', '20000000-0000-4000-8000-000000000001', 'ACTIVE', NOW(), NOW()),

  -- Posgres Cafe memberships
  ('60000000-0000-4000-8000-000000000008', '33333333-3333-4333-8333-333333333333', '50000000-0000-4000-8000-000000000005', '+3123456789', 'nika.chhun@demo.local', '$2b$12$2tEqR2fsxAOgcXCjDqbsA.0qZhePT6ea.epSVTuJcaF2tZIowBauu', 'Nika', 'Chhun', 'Nika Chhun', '30000000-0000-4000-8000-000000000001', '30000000-0000-4000-8000-000000000001', 'ACTIVE', NOW(), NOW()),
  ('60000000-0000-4000-8000-000000000009', '33333333-3333-4333-8333-333333333333', '50000000-0000-4000-8000-000000000008', '+4123456789', 'elon.zuckerberg@posgres.demo', '$2b$12$2tEqR2fsxAOgcXCjDqbsA.0qZhePT6ea.epSVTuJcaF2tZIowBauu', 'Elon', 'Zuckerberg', 'Elon Zuckerberg', '30000000-0000-4000-8000-000000000001', '30000000-0000-4000-8000-000000000001', 'ACTIVE', NOW(), NOW())
ON CONFLICT (id) DO NOTHING;

-- ---------------------------------------------------------------------
-- Branch assignments
-- ---------------------------------------------------------------------
INSERT INTO employee_branch_assignments (employee_id, branch_id, role, active, assigned_at) VALUES
  ('60000000-0000-4000-8000-000000000001', '10000000-0000-4000-8000-000000000001', 'ADMIN', TRUE, NOW()),
  ('60000000-0000-4000-8000-000000000001', '10000000-0000-4000-8000-000000000002', 'ADMIN', TRUE, NOW()),
  ('60000000-0000-4000-8000-000000000002', '10000000-0000-4000-8000-000000000001', 'CASHIER', TRUE, NOW()),
  ('60000000-0000-4000-8000-000000000003', '10000000-0000-4000-8000-000000000002', 'CASHIER', TRUE, NOW()),
  ('60000000-0000-4000-8000-000000000004', '10000000-0000-4000-8000-000000000002', 'CASHIER', TRUE, NOW()),
  ('60000000-0000-4000-8000-000000000005', '20000000-0000-4000-8000-000000000001', 'ADMIN', TRUE, NOW()),
  ('60000000-0000-4000-8000-000000000006', '20000000-0000-4000-8000-000000000001', 'CASHIER', TRUE, NOW()),
  ('60000000-0000-4000-8000-000000000007', '20000000-0000-4000-8000-000000000001', 'CASHIER', TRUE, NOW()),
  ('60000000-0000-4000-8000-000000000008', '30000000-0000-4000-8000-000000000001', 'ADMIN', TRUE, NOW()),
  ('60000000-0000-4000-8000-000000000009', '30000000-0000-4000-8000-000000000001', 'CASHIER', TRUE, NOW())
ON CONFLICT (employee_id, branch_id) DO NOTHING;

-- ---------------------------------------------------------------------
-- Staff shift assignments (cashiers: weekday 08:00 - 17:00)
-- ---------------------------------------------------------------------
INSERT INTO staff_shift_assignments (
  tenant_id,
  employee_id,
  branch_id,
  day_of_week,
  start_time,
  end_time,
  is_off
) VALUES
  -- X Cafe (Sen Sok)
  ('11111111-1111-4111-8111-111111111111', '60000000-0000-4000-8000-000000000002', '10000000-0000-4000-8000-000000000001', 1, '08:00', '17:00', FALSE),
  ('11111111-1111-4111-8111-111111111111', '60000000-0000-4000-8000-000000000002', '10000000-0000-4000-8000-000000000001', 2, '08:00', '17:00', FALSE),
  ('11111111-1111-4111-8111-111111111111', '60000000-0000-4000-8000-000000000002', '10000000-0000-4000-8000-000000000001', 3, '08:00', '17:00', FALSE),
  ('11111111-1111-4111-8111-111111111111', '60000000-0000-4000-8000-000000000002', '10000000-0000-4000-8000-000000000001', 4, '08:00', '17:00', FALSE),
  ('11111111-1111-4111-8111-111111111111', '60000000-0000-4000-8000-000000000002', '10000000-0000-4000-8000-000000000001', 5, '08:00', '17:00', FALSE),
  -- X Cafe (Olympic)
  ('11111111-1111-4111-8111-111111111111', '60000000-0000-4000-8000-000000000003', '10000000-0000-4000-8000-000000000002', 1, '08:00', '17:00', FALSE),
  ('11111111-1111-4111-8111-111111111111', '60000000-0000-4000-8000-000000000003', '10000000-0000-4000-8000-000000000002', 2, '08:00', '17:00', FALSE),
  ('11111111-1111-4111-8111-111111111111', '60000000-0000-4000-8000-000000000003', '10000000-0000-4000-8000-000000000002', 3, '08:00', '17:00', FALSE),
  ('11111111-1111-4111-8111-111111111111', '60000000-0000-4000-8000-000000000003', '10000000-0000-4000-8000-000000000002', 4, '08:00', '17:00', FALSE),
  ('11111111-1111-4111-8111-111111111111', '60000000-0000-4000-8000-000000000003', '10000000-0000-4000-8000-000000000002', 5, '08:00', '17:00', FALSE),
  ('11111111-1111-4111-8111-111111111111', '60000000-0000-4000-8000-000000000004', '10000000-0000-4000-8000-000000000002', 1, '08:00', '17:00', FALSE),
  ('11111111-1111-4111-8111-111111111111', '60000000-0000-4000-8000-000000000004', '10000000-0000-4000-8000-000000000002', 2, '08:00', '17:00', FALSE),
  ('11111111-1111-4111-8111-111111111111', '60000000-0000-4000-8000-000000000004', '10000000-0000-4000-8000-000000000002', 3, '08:00', '17:00', FALSE),
  ('11111111-1111-4111-8111-111111111111', '60000000-0000-4000-8000-000000000004', '10000000-0000-4000-8000-000000000002', 4, '08:00', '17:00', FALSE),
  ('11111111-1111-4111-8111-111111111111', '60000000-0000-4000-8000-000000000004', '10000000-0000-4000-8000-000000000002', 5, '08:00', '17:00', FALSE),
  -- Nodepresso
  ('22222222-2222-4222-8222-222222222222', '60000000-0000-4000-8000-000000000006', '20000000-0000-4000-8000-000000000001', 1, '08:00', '17:00', FALSE),
  ('22222222-2222-4222-8222-222222222222', '60000000-0000-4000-8000-000000000006', '20000000-0000-4000-8000-000000000001', 2, '08:00', '17:00', FALSE),
  ('22222222-2222-4222-8222-222222222222', '60000000-0000-4000-8000-000000000006', '20000000-0000-4000-8000-000000000001', 3, '08:00', '17:00', FALSE),
  ('22222222-2222-4222-8222-222222222222', '60000000-0000-4000-8000-000000000006', '20000000-0000-4000-8000-000000000001', 4, '08:00', '17:00', FALSE),
  ('22222222-2222-4222-8222-222222222222', '60000000-0000-4000-8000-000000000006', '20000000-0000-4000-8000-000000000001', 5, '08:00', '17:00', FALSE),
  ('22222222-2222-4222-8222-222222222222', '60000000-0000-4000-8000-000000000007', '20000000-0000-4000-8000-000000000001', 1, '08:00', '17:00', FALSE),
  ('22222222-2222-4222-8222-222222222222', '60000000-0000-4000-8000-000000000007', '20000000-0000-4000-8000-000000000001', 2, '08:00', '17:00', FALSE),
  ('22222222-2222-4222-8222-222222222222', '60000000-0000-4000-8000-000000000007', '20000000-0000-4000-8000-000000000001', 3, '08:00', '17:00', FALSE),
  ('22222222-2222-4222-8222-222222222222', '60000000-0000-4000-8000-000000000007', '20000000-0000-4000-8000-000000000001', 4, '08:00', '17:00', FALSE),
  ('22222222-2222-4222-8222-222222222222', '60000000-0000-4000-8000-000000000007', '20000000-0000-4000-8000-000000000001', 5, '08:00', '17:00', FALSE),
  -- Posgres Cafe
  ('33333333-3333-4333-8333-333333333333', '60000000-0000-4000-8000-000000000009', '30000000-0000-4000-8000-000000000001', 1, '08:00', '17:00', FALSE),
  ('33333333-3333-4333-8333-333333333333', '60000000-0000-4000-8000-000000000009', '30000000-0000-4000-8000-000000000001', 2, '08:00', '17:00', FALSE),
  ('33333333-3333-4333-8333-333333333333', '60000000-0000-4000-8000-000000000009', '30000000-0000-4000-8000-000000000001', 3, '08:00', '17:00', FALSE),
  ('33333333-3333-4333-8333-333333333333', '60000000-0000-4000-8000-000000000009', '30000000-0000-4000-8000-000000000001', 4, '08:00', '17:00', FALSE),
  ('33333333-3333-4333-8333-333333333333', '60000000-0000-4000-8000-000000000009', '30000000-0000-4000-8000-000000000001', 5, '08:00', '17:00', FALSE)
ON CONFLICT (employee_id, branch_id, day_of_week) DO NOTHING;

-- ---------------------------------------------------------------------
-- Default policy rows (branch-scoped)
-- ---------------------------------------------------------------------
INSERT INTO branch_sales_policies (tenant_id, branch_id) VALUES
  ('11111111-1111-4111-8111-111111111111', '10000000-0000-4000-8000-000000000001'),
  ('11111111-1111-4111-8111-111111111111', '10000000-0000-4000-8000-000000000002'),
  ('22222222-2222-4222-8222-222222222222', '20000000-0000-4000-8000-000000000001'),
  ('33333333-3333-4333-8333-333333333333', '30000000-0000-4000-8000-000000000001')
ON CONFLICT (tenant_id, branch_id) DO NOTHING;

INSERT INTO branch_inventory_policies (tenant_id, branch_id) VALUES
  ('11111111-1111-4111-8111-111111111111', '10000000-0000-4000-8000-000000000001'),
  ('11111111-1111-4111-8111-111111111111', '10000000-0000-4000-8000-000000000002'),
  ('22222222-2222-4222-8222-222222222222', '20000000-0000-4000-8000-000000000001'),
  ('33333333-3333-4333-8333-333333333333', '30000000-0000-4000-8000-000000000001')
ON CONFLICT (tenant_id, branch_id) DO NOTHING;

INSERT INTO branch_cash_session_policies (tenant_id, branch_id) VALUES
  ('11111111-1111-4111-8111-111111111111', '10000000-0000-4000-8000-000000000001'),
  ('11111111-1111-4111-8111-111111111111', '10000000-0000-4000-8000-000000000002'),
  ('22222222-2222-4222-8222-222222222222', '20000000-0000-4000-8000-000000000001'),
  ('33333333-3333-4333-8333-333333333333', '30000000-0000-4000-8000-000000000001')
ON CONFLICT (tenant_id, branch_id) DO NOTHING;

INSERT INTO branch_attendance_policies (tenant_id, branch_id) VALUES
  ('11111111-1111-4111-8111-111111111111', '10000000-0000-4000-8000-000000000001'),
  ('11111111-1111-4111-8111-111111111111', '10000000-0000-4000-8000-000000000002'),
  ('22222222-2222-4222-8222-222222222222', '20000000-0000-4000-8000-000000000001'),
  ('33333333-3333-4333-8333-333333333333', '30000000-0000-4000-8000-000000000001')
ON CONFLICT (tenant_id, branch_id) DO NOTHING;

-- ---------------------------------------------------------------------
-- Tenant limits (defaults via DB columns)
-- ---------------------------------------------------------------------
INSERT INTO tenant_limits (tenant_id) VALUES
  ('11111111-1111-4111-8111-111111111111'),
  ('22222222-2222-4222-8222-222222222222'),
  ('33333333-3333-4333-8333-333333333333')
ON CONFLICT (tenant_id) DO NOTHING;

-- ---------------------------------------------------------------------
-- Refresh branch policy projection (best-effort)
-- ---------------------------------------------------------------------
DO $$
DECLARE
  r RECORD;
BEGIN
  FOR r IN SELECT DISTINCT tenant_id FROM branches LOOP
    PERFORM refresh_branch_policies_for_tenant(r.tenant_id);
  END LOOP;
END $$;
